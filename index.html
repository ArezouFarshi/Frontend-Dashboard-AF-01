<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>DPP Dashboard – Panels</title>
  <link rel="stylesheet" href="styles.css">
  <!-- Ethers v6 -->
  <script src="https://cdn.jsdelivr.net/npm/ethers@6.13.2/dist/ethers.umd.min.js"></script>
</head>
<body>
  <header>
    <h1>Blockchain‑Powered DPP Dashboard</h1>
    <p>Query on‑chain events and off‑chain DPP JSON for a façade panel.</p>
  </header>

  <section class="card">
    <h2>Configuration</h2>
    <div class="grid">
      <label>
        RPC URL (Sepolia):
        <input id="rpcUrl" type="text" value="https://sepolia.infura.io/v3/57ea67cde27f45f9af5a69bdc5c92332">
      </label>
      <label>
        Contract Address:
        <input id="contractAddress" type="text" value="0x59B649856d8c5Fb6991d30a345f0b923eA91a3f7">
      </label>
      <label>
        Oracle Backend Base URL:
        <input id="backendBase" type="text" value="https://dpp-update-frontend-af02.onrender.com">
      </label>
    </div>
  </section>

  <section class="card">
    <h2>Lookup Panel</h2>
    <div class="grid">
      <label>
        Panel ID (exact, e.g. <code>ID 9 C 12</code>):
        <input id="panelId" type="text" placeholder="ID 9 C 12">
      </label>
      <label>
        Access Tier for JSON:
        <select id="accessTier">
          <option value="public">public</option>
          <option value="tier1">tier1</option>
          <option value="tier2">tier2</option>
        </select>
      </label>
      <label>
        From Block:
        <input id="fromBlock" type="number" placeholder="0">
      </label>
      <label>
        To Block (leave blank for latest):
        <input id="toBlock" type="number" placeholder="">
      </label>
    </div>
    <div class="actions">
      <button id="btnLoadEvents">Load On‑Chain Events</button>
      <button id="btnLoadDpp">Load DPP JSON</button>
      <button id="btnHash">Get JSON Keccak</button>
    </div>
  </section>

  <section class="card">
    <h2>On‑Chain Event Timeline</h2>
    <div id="eventsHelp" class="muted">Click “Load On‑Chain Events”</div>
    <table id="eventsTable" class="hidden">
      <thead>
        <tr>
          <th>Time (UTC)</th>
          <th>eventType</th>
          <th>faultType</th>
          <th>faultSeverity</th>
          <th>actionTaken</th>
          <th>Tx</th>
        </tr>
      </thead>
      <tbody id="eventsBody"></tbody>
    </table>
  </section>

  <section class="card">
    <h2>DPP JSON (Off‑Chain)</h2>
    <div class="muted">Access controlled via <code>Access_Tier</code> fields on your backend.</div>
    <div class="row">
      <a id="jsonLink" href="#" target="_blank" class="tiny">Open raw JSON</a>
      <a id="hashLink" href="#" target="_blank" class="tiny">Open hash endpoint</a>
    </div>
    <pre id="jsonOut" class="code"></pre>
  </section>

  <footer>
    <small>Contract logs are decoded client‑side. DPP JSON served by your Oracle backend.</small>
  </footer>

  <script src="script.js"></script>
</body>
</html>
